<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Company - CertiGo</title>
    <link rel="stylesheet" href="style.css">
    <script src="auth.js"></script>
    <style>
        .delete-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .delete-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .delete-header h1 {
            color: #dc3545;
            margin-bottom: 10px;
        }
        .delete-warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .delete-warning p {
            margin: 0;
            color: #856404;
        }
        .company-details {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .company-details h3 {
            margin-top: 0;
            color: #333;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #dee2e6;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            font-weight: bold;
            color: #666;
        }
        .detail-value {
            color: #333;
        }
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .btn-cancel {
            background-color: #6c757d;
            color: white;
        }
        .btn-cancel:hover {
            background-color: #5a6268;
        }
        .btn-delete {
            background-color: #dc3545;
            color: white;
        }
        .btn-delete:hover {
            background-color: #c82333;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
    </style>
</head>
<body class="certificates-page">

<div class="navbar">
    <div class="logo">
        <img src="logo.png" alt="CertiGo Logo">
        <h2>CertiGo</h2>
    </div>
    <nav>
        <a href="admin-index.html">Admin Dashboard</a>
        <a href="get-all-certificates.html">Certificates</a>
        <a href="get-all-companies.html">Companies</a>
        <a href="add-company.html" class="admin-only">Add Company</a>
    </nav>
    <div class="dropdown">
        <button class="dropbtn" id="accountBtn">Account</button>
        <div class="dropdown-content" id="accountDropdown">
            <a href="#" onclick="showUserProfile(); return false;">Profile</a>
            <a href="#" onclick="logout(); return false;">Logout</a>
        </div>
    </div>
</div>

<div class="delete-container">
    <div class="delete-header">
        <h1>‚ö†Ô∏è Delete Company</h1>
        <p>Are you sure you want to delete this company?</p>
    </div>

    <div class="delete-warning">
        <p><strong>Warning:</strong> This action will deactivate the company. This operation cannot be undone.</p>
    </div>

    <div id="loadingDiv" class="loading" style="display: none;">
        <p>Loading company details...</p>
    </div>

    <div id="companyDetailsDiv" class="company-details" style="display: none;">
        <h3>Company Details</h3>
        <div class="detail-row">
            <span class="detail-label">Company ID:</span>
            <span class="detail-value" id="dispId">-</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Company Name:</span>
            <span class="detail-value" id="dispName">-</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Email:</span>
            <span class="detail-value" id="dispEmail">-</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Industry:</span>
            <span class="detail-value" id="dispIndustry">-</span>
        </div>
        <div class="detail-row">
            <span class="detail-label">Location:</span>
            <span class="detail-value" id="dispLocation">-</span>
        </div>
    </div>

    <div class="button-group">
        <a href="get-all-companies.html" class="btn btn-cancel">‚úñÔ∏è Cancel</a>
        <button class="btn btn-delete" onclick="executeDelete()">üóëÔ∏è Delete Company</button>
    </div>
</div>

<script>
    let companyId = null;

    window.addEventListener('DOMContentLoaded', async () => {
        // Run admin check from auth.js
        if (typeof requireAdmin === "function") {
            requireAdmin();
        }

        // Get the company ID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        companyId = urlParams.get('companyId');

        if (!companyId || companyId === 'null' || companyId === 'undefined') {
            alert('No valid company ID provided');
            window.location.href = 'get-all-companies.html';
            return;
        }

        // Convert to number
        companyId = parseInt(companyId, 10);
        if (isNaN(companyId)) {
            alert('Invalid company ID format');
            window.location.href = 'get-all-companies.html';
            return;
        }

        // Show loading
        document.getElementById('loadingDiv').style.display = 'block';

        try {
            // Fetch all companies and find the one we need
            const response = await fetch('http://localhost:8080/company/getAll');

            if (!response.ok) {
                throw new Error('Failed to fetch companies');
            }

            const companies = await response.json();
            const company = companies.find(c => c.id === companyId);

            if (company) {
                // Display company details
                document.getElementById('dispId').textContent = company.id;
                document.getElementById('dispName').textContent = company.companyName || 'N/A';
                document.getElementById('dispEmail').textContent = company.contactEmail || 'N/A';
                document.getElementById('dispIndustry').textContent = company.industry || 'N/A';
                document.getElementById('dispLocation').textContent = company.location || 'N/A';

                document.getElementById('loadingDiv').style.display = 'none';
                document.getElementById('companyDetailsDiv').style.display = 'block';
            } else {
                alert('Company not found');
                window.location.href = 'get-all-companies.html';
            }
        } catch (error) {
            console.error('Error loading company:', error);
            alert('Error loading company details. Please try again.');
            window.location.href = 'get-all-companies.html';
        }
    });

    async function executeDelete() {
        if (!companyId) {
            alert('No company ID available for deletion');
            return;
        }

        // Confirm deletion
        if (!confirm('Are you absolutely sure you want to delete this company?')) {
            return;
        }

        try {
            const response = await fetch(`http://localhost:8080/company/delete?id=${companyId}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                const message = await response.text();
                alert(message || 'Company deleted successfully');
                window.location.href = 'get-all-companies.html';
            } else {
                const errorText = await response.text();
                alert(`Error: ${errorText || 'Failed to delete company'}`);
            }
        } catch (error) {
            console.error('Delete error:', error);
            alert('Error deleting company. Please ensure the backend server is running.');
        }
    }
</script>
</body>
</html>
