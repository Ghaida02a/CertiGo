<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CertiGo - Create Account</title>
    <link rel="stylesheet" href="style.css">
    <script src="auth.js"></script>
</head>
<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="logo">
        <img src="C:\Users\LENOVO\Desktop\logo\36986b76-9c45-4c51-8486-c25524aba893.png" alt="CertiGo Logo">
        <h2>CertiGo</h2>
    </div>
    <nav>
        <a href="index.html">Home</a>
        <a href="get-all-certificates.html">Certificates</a>
        <a href="signin.html">Sign In</a>
    </nav>

</div>

<!-- SIGN UP FORM -->
<div class="hero" style="padding:50px 20px;">
    <h1>Create Your Account</h1>
    <p>Join CertiGo and start learning today!</p>

    <form class="form" style="max-width:400px;margin:30px auto; text-align:left;">
        <label for="name">Full Name</label>
        <input type="text" id="name" name="name" placeholder="Your name" required style="width:100%;padding:10px;margin-bottom:15px;">

        <label for="email">Email</label>
        <input type="email" id="email" name="email" placeholder="Your email" required style="width:100%;padding:10px;margin-bottom:15px;">

        <label for="password">Password</label>
        <input type="password" id="password" name="password" placeholder="Password" required style="width:100%;padding:10px;margin-bottom:15px;">

        <label for="confirm-password">Confirm Password</label>
        <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirm Password" required style="width:100%;padding:10px;margin-bottom:15px;">

        <label for="role">Account Type</label>
        <select id="role" name="role" required style="width:100%;padding:10px;margin-bottom:20px;border:1px solid #ccc;border-radius:4px;background-color:white;font-size:14px;">
            <option value="">Select your role...</option>
            <option value="TRAINEE">Trainee</option>
            <option value="ADMIN">Admin</option>
        </select>

        <button type="submit" style="width:100%;">Sign Up</button>
    </form>

    <p style="text-align:center;">Already have an account? <a href="signin.html" style="color:#ffe; text-decoration:underline;">Sign In</a></p>
</div>

<script>
    document.querySelector('.form').addEventListener('submit', async function(e) {
        e.preventDefault();

        // Get form values
        const name = document.getElementById('name').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirm-password').value;
        const role = document.getElementById('role').value;

        // Validate passwords match
        if (password !== confirmPassword) {
            alert('Passwords do not match!');
            return;
        }

        // Validate role is selected
        if (!role) {
            alert('Please select an account type!');
            return;
        }

        // Validate password strength (optional)
        if (password.length < 6) {
            alert('Password must be at least 6 characters long!');
            return;
        }

        // Build the request object
        const formData = {
            username: name,
            email: email,
            password: password,
            role: role
        };

        // Disable submit button
        const submitBtn = document.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Creating Account...';

        try {
            const response = await fetch('http://localhost:8080/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            if (response.ok) {
                const result = await response.json();
                alert('Account created successfully! Please sign in.');
                // Redirect to signin page
                window.location.href = 'signin.html';
            } else {
                const errorData = await response.json();
                alert('Error creating account: ' + (errorData.message || 'Please try again.'));
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign Up';
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Network error. Please check your connection and try again.');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Sign Up';
        }
    });
</script>

</body>
</html>